#+TITLE: Complete Workflow Guide
#+AUTHOR: Telegram Note Bot
#+DATE: 2025

* Overview

This guide explains the complete workflow from writing code to running in production.

* The Big Picture

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. YOU          â”‚ Write code on your laptop
â”‚    (Local Dev)  â”‚ Test locally
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ git push
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. GITHUB       â”‚ Stores your code
â”‚    (Code Repo)  â”‚ Triggers CI/CD
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ webhook trigger
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. GITHUB       â”‚ Automated testing
â”‚    ACTIONS      â”‚ Build Docker image
â”‚    (CI/CD)      â”‚ Publish to GHCR
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ docker push
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. GHCR         â”‚ Stores Docker images
â”‚    (Registry)   â”‚ ghcr.io/mandoo180/telegram-note-bot:latest
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ docker pull
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. YOUR SERVER  â”‚ Runs the bot
â”‚    (Production) â”‚ Serves users
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

* Detailed Workflow

** Step 1: Local Development (Your Laptop)

*** What You Do

You write code, test it locally, and commit changes.

#+begin_src bash
# On your laptop
cd ~/Projects/telegram-note

# Make changes to code
emacs src/main.py  # or your editor

# Test locally
python src/main.py

# Commit changes
git add .
git commit -m "Add new feature"

# Push to GitHub
git push origin main
#+end_src

*** What Happens Locally

- You edit files in =src/=, =docs/=, etc.
- You test the bot locally (optional but recommended)
- Git tracks your changes
- Nothing is deployed yet - it's just on your laptop

** Step 2: GitHub Repository

*** What You Do

Push your commits to GitHub.

#+begin_src bash
git push origin main
#+end_src

*** What Happens on GitHub

1. GitHub receives your code
2. Stores it in the repository: =github.com/mandoo180/telegram-note-bot=
3. Immediately triggers GitHub Actions workflows
4. You can see this at: https://github.com/mandoo180/telegram-note-bot/actions

** Step 3: GitHub Actions (Automated CI/CD)

This is where the magic happens - *completely automated*!

*** Workflow #1: CI Pipeline (=.github/workflows/ci.yml=)

Runs on every push to =main= or =develop= branches.

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GITHUB ACTIONS CI PIPELINE           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ JOB 1: LINT                     â”‚ â”‚
â”‚ â”‚ â€¢ Check code style (black)      â”‚ â”‚
â”‚ â”‚ â€¢ Check imports (isort)         â”‚ â”‚
â”‚ â”‚ â€¢ Run flake8 linter             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ JOB 2: TEST                     â”‚ â”‚
â”‚ â”‚ â€¢ Test on Python 3.9, 3.10, 3.11â”‚ â”‚
â”‚ â”‚ â€¢ Initialize database           â”‚ â”‚
â”‚ â”‚ â€¢ Test imports                  â”‚ â”‚
â”‚ â”‚ â€¢ Test version module           â”‚ â”‚
â”‚ â”‚ â€¢ Run check_reminders.py        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ JOB 3: DOCKER                   â”‚ â”‚
â”‚ â”‚ â€¢ Build Docker image            â”‚ â”‚
â”‚ â”‚ â€¢ Test image (init DB, etc.)    â”‚ â”‚
â”‚ â”‚ â€¢ Run diagnostics in container  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ JOB 4: SECURITY                 â”‚ â”‚
â”‚ â”‚ â€¢ Scan dependencies (safety)    â”‚ â”‚
â”‚ â”‚ â€¢ Vulnerability scan (Trivy)    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ JOB 5: SUMMARY                  â”‚ â”‚
â”‚ â”‚ â€¢ Report overall status         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

If any job fails, the pipeline stops and you get notified.

*** Workflow #2: Docker Build & Publish (=.github/workflows/docker-publish.yml=)

Runs on every push to =main= branch (after CI passes).

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOCKER BUILD & PUBLISH PIPELINE      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ STEP 1: Checkout Code           â”‚ â”‚
â”‚ â”‚ â€¢ Download your latest code     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ STEP 2: Docker Login            â”‚ â”‚
â”‚ â”‚ â€¢ Login to ghcr.io              â”‚ â”‚
â”‚ â”‚ â€¢ Using GITHUB_TOKEN            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ STEP 3: Build Docker Image      â”‚ â”‚
â”‚ â”‚ â€¢ Run: docker build -t ...      â”‚ â”‚
â”‚ â”‚ â€¢ Build for amd64 + arm64       â”‚ â”‚
â”‚ â”‚ â€¢ Cache layers for speed        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ STEP 4: Tag Image               â”‚ â”‚
â”‚ â”‚ â€¢ latest                        â”‚ â”‚
â”‚ â”‚ â€¢ main                          â”‚ â”‚
â”‚ â”‚ â€¢ sha-abc1234                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ STEP 5: Push to GHCR            â”‚ â”‚
â”‚ â”‚ â€¢ Upload to ghcr.io             â”‚ â”‚
â”‚ â”‚ â€¢ Image now available!          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ STEP 6: Security Scan           â”‚ â”‚
â”‚ â”‚ â€¢ Scan published image          â”‚ â”‚
â”‚ â”‚ â€¢ Check for vulnerabilities     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

After this completes, your Docker image is available at:
- =ghcr.io/mandoo180/telegram-note-bot:latest=
- =ghcr.io/mandoo180/telegram-note-bot:main=
- =ghcr.io/mandoo180/telegram-note-bot:sha-abc1234=

*** Other Workflows

**** Scheduled Tests (=.github/workflows/scheduled-tests.yml=)
- Runs daily at 2 AM UTC
- Health check to ensure everything still works
- Creates GitHub issue if tests fail

**** Release (=.github/workflows/release.yml=)
- Triggers when you create a version tag (e.g., =v1.0.0=)
- Builds release Docker images
- Creates GitHub Release with changelog
- Publishes versioned images

** Step 4: GitHub Container Registry (GHCR)

*** What Is GHCR?

GHCR (=ghcr.io=) is like Docker Hub, but integrated with GitHub.

*** What Gets Stored

Your built Docker images are stored here:

#+begin_example
ghcr.io/mandoo180/telegram-note-bot:latest      â† Most recent build
ghcr.io/mandoo180/telegram-note-bot:main        â† Same as latest
ghcr.io/mandoo180/telegram-note-bot:sha-abc1234 â† Specific commit
ghcr.io/mandoo180/telegram-note-bot:v1.0.0      â† Release version
#+end_example

*** How to View

1. Go to: https://github.com/mandoo180/telegram-note-bot
2. Click "Packages" on the right side
3. You'll see =telegram-note-bot= package
4. Click it to see all available tags/versions

** Step 5: Your Production Server

*** What You Do

On your cloud server, you pull and run the Docker image.

#+begin_src bash
# SSH to your server
ssh your-server

# Pull latest image
docker pull ghcr.io/mandoo180/telegram-note-bot:latest

# Or use the deployment script (recommended)
./deploy.sh
#+end_src

*** What Happens on Server

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPLOYMENT SCRIPT (deploy.sh)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. Check .env file              â”‚ â”‚
â”‚ â”‚    â€¢ Verify TELEGRAM_BOT_TOKEN  â”‚ â”‚
â”‚ â”‚    â€¢ Verify configuration       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 2. Pull Latest Image            â”‚ â”‚
â”‚ â”‚    docker pull ghcr.io/...      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 3. Stop Old Container           â”‚ â”‚
â”‚ â”‚    docker stop telegram-note-botâ”‚ â”‚
â”‚ â”‚    docker rm telegram-note-bot  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 4. Initialize Database          â”‚ â”‚
â”‚ â”‚    (if doesn't exist)           â”‚ â”‚
â”‚ â”‚    docker run ... init_db.py    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 5. Start New Container          â”‚ â”‚
â”‚ â”‚    docker run -d \              â”‚ â”‚
â”‚ â”‚      --name telegram-note-bot \ â”‚ â”‚
â”‚ â”‚      --restart unless-stopped \ â”‚ â”‚
â”‚ â”‚      --env-file .env \          â”‚ â”‚
â”‚ â”‚      -v $(pwd)/data:/app/data \ â”‚ â”‚
â”‚ â”‚      ghcr.io/.../latest         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â–¼                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 6. Verify Deployment            â”‚ â”‚
â”‚ â”‚    â€¢ Check container running    â”‚ â”‚
â”‚ â”‚    â€¢ Display version            â”‚ â”‚
â”‚ â”‚    â€¢ Show status                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

*** The Running Container

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOCKER CONTAINER                       â”‚
â”‚ (telegram-note-bot)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Python Process                   â”‚ â”‚
â”‚  â”‚ â€¢ src/main.py running            â”‚ â”‚
â”‚  â”‚ â€¢ Connects to Telegram API       â”‚ â”‚
â”‚  â”‚ â€¢ Handles user commands          â”‚ â”‚
â”‚  â”‚ â€¢ Sends reminders                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Web App Server                   â”‚ â”‚
â”‚  â”‚ â€¢ Port 8000                      â”‚ â”‚
â”‚  â”‚ â€¢ Serves note/schedule editors   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Data Volume (mounted)            â”‚ â”‚
â”‚  â”‚ /app/data/                       â”‚ â”‚
â”‚  â”‚ â””â”€ telegram_note.db              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â–²                              â”‚
â”‚         â”‚ persisted on host            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Host Serverâ”‚
    â”‚ ~/data/    â”‚
    â”‚ telegram_  â”‚
    â”‚ note.db    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

* Complete Example Workflow

Let's walk through a complete example from start to finish.

** Scenario: Add a New Feature

You want to add a =/stats= command to show usage statistics.

** Day 1: Development

#+begin_src bash
# On your laptop
cd ~/Projects/telegram-note

# Create a new branch (optional but recommended)
git checkout -b feature/stats-command

# Edit the code
emacs src/main.py
# Add stats_command() method and handler

# Test locally
export TELEGRAM_BOT_TOKEN="your_token"
python src/main.py
# Test the /stats command in Telegram

# Commit your changes
git add src/main.py
git commit -m "feat: add /stats command to show usage statistics"

# Push to GitHub
git push origin feature/stats-command
#+end_src

** What Happens Automatically

#+begin_example
1. GitHub receives your code
   â†“
2. GitHub Actions triggers CI pipeline
   â†“
3. Runs tests on Python 3.9, 3.10, 3.11
   â†“
4. Builds Docker image
   â†“
5. All tests pass âœ…
#+end_example

** Day 2: Merge to Main

#+begin_src bash
# On GitHub website:
# 1. Create Pull Request from feature/stats-command to main
# 2. Review the code
# 3. Check CI status (should be green âœ…)
# 4. Click "Merge"

# Or via command line:
git checkout main
git merge feature/stats-command
git push origin main
#+end_src

** What Happens Automatically (Part 2)

#+begin_example
1. GitHub Actions detects push to main
   â†“
2. Runs FULL CI pipeline again
   â†“
3. Builds Docker image
   â†“
4. Pushes to GHCR:
   â€¢ ghcr.io/mandoo180/telegram-note-bot:latest
   â€¢ ghcr.io/mandoo180/telegram-note-bot:main
   â€¢ ghcr.io/mandoo180/telegram-note-bot:sha-abc1234
   â†“
5. Image is now available! ğŸ‰
#+end_example

** Day 2: Deploy to Production

#+begin_src bash
# SSH to your server
ssh your-cloud-server

# Deploy new version
./deploy.sh

# Output:
# [INFO] Pulling image: ghcr.io/mandoo180/telegram-note-bot:latest
# [INFO] Image pulled successfully
# [INFO] Stopping old container...
# [INFO] Starting new container...
# [INFO] Container started successfully
# [INFO] Bot version:
#   Version: 1.0.0
# [INFO] âœ… Deployment successful!
#+end_src

** Day 2: Verify

In Telegram:
- Send: =/stats= to your bot
- You should see the new statistics!
- Send: =/version= to confirm version

* Timeline Example

Here's what the timeline looks like:

#+begin_example
10:00 AM - You write code on laptop
10:30 AM - git push origin main
10:31 AM - GitHub Actions starts CI/CD (automatic)
10:35 AM - Tests pass âœ…
10:36 AM - Docker image builds (automatic)
10:40 AM - Image pushed to GHCR âœ…
          New image available at ghcr.io/mandoo180/telegram-note-bot:latest

11:00 AM - You SSH to server
11:01 AM - Run: ./deploy.sh
11:02 AM - New version is live! âœ…

Total time: ~1 hour (mostly automated)
Actual work: ~30 minutes (writing code)
Deployment time: 1-2 minutes
#+end_example

* Key Points to Understand

** You Never Build Docker Images Manually

- GitHub Actions builds them for you
- You just =git push=
- Images appear in GHCR automatically

** You Never Upload to Server Manually

- No =scp= or =rsync= needed
- Just =./deploy.sh= pulls from GHCR
- Server always gets the exact same image that was tested

** Database Persists Across Deployments

#+begin_example
Container 1 (old version)     Container 2 (new version)
      â”‚                              â”‚
      â””â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
        â”‚  Host: ~/data/          â”‚
        â”‚  telegram_note.db       â”‚  â† SAME DATABASE
        â”‚  (persisted)            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

Your data is safe! Only the container (code) is replaced.

** Multiple Environments

You can run different versions:

#+begin_example
Development Server:
  IMAGE_TAG=main ./deploy.sh

Staging Server:
  IMAGE_TAG=sha-abc1234 ./deploy.sh

Production Server:
  IMAGE_TAG=v1.0.0 ./deploy.sh
#+end_example

* Troubleshooting the Workflow

** "My changes aren't deployed!"

Check:
1. Did you =git push=?
   #+begin_src bash
   git status
   git log origin/main..HEAD  # Shows unpushed commits
   #+end_src

2. Did GitHub Actions succeed?
   - Visit: https://github.com/mandoo180/telegram-note-bot/actions
   - Look for green checkmarks âœ…

3. Did you run =./deploy.sh=?
   - The server won't update automatically
   - You must pull the new image

** "GitHub Actions failed!"

1. Click on the failed workflow
2. Click on the failed job
3. Read the error message
4. Fix the code
5. =git push= again

** "Bot not working after deployment"

#+begin_src bash
# Check container status
docker ps -a | grep telegram-note

# View logs
docker logs telegram-note-bot

# Check version
docker exec telegram-note-bot python -c "import sys; sys.path.insert(0, '/app/src'); from version import __version__; print(__version__)"
#+end_src

* Summary

#+begin_example
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETE WORKFLOW SUMMARY                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  YOU (Laptop)                                   â”‚
â”‚    â”‚ Write code                                 â”‚
â”‚    â”‚ git commit                                 â”‚
â”‚    â”‚ git push                                   â”‚
â”‚    â–¼                                            â”‚
â”‚  GITHUB                                         â”‚
â”‚    â”‚ Stores code                                â”‚
â”‚    â”‚ Triggers workflows                         â”‚
â”‚    â–¼                                            â”‚
â”‚  GITHUB ACTIONS                                 â”‚
â”‚    â”‚ Run tests                                  â”‚
â”‚    â”‚ Build Docker image                         â”‚
â”‚    â”‚ Push to GHCR                               â”‚
â”‚    â–¼                                            â”‚
â”‚  GHCR (ghcr.io)                                 â”‚
â”‚    â”‚ Stores Docker images                       â”‚
â”‚    â”‚ Tagged: latest, main, sha-*, v*            â”‚
â”‚    â–¼                                            â”‚
â”‚  YOUR SERVER                                    â”‚
â”‚    â”‚ ./deploy.sh                                â”‚
â”‚    â”‚ docker pull ghcr.io/.../latest             â”‚
â”‚    â”‚ docker run ...                             â”‚
â”‚    â–¼                                            â”‚
â”‚  TELEGRAM USERS                                 â”‚
â”‚    â”‚ Use your bot!                              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#+end_example

*The beauty of this workflow:*
- You just write code and =git push=
- Everything else is automatic
- Consistent, tested deployments every time
- Easy rollback if something breaks
- Zero-downtime updates possible
